<main class="flex flex-col h-screen relative">
  @if (open()) {
    <modal (usernameChange)="handleUsernameChange($event)"> </modal>
  }
  <header class="p-4 bg-slate-900 text-white flex justify-between">
    <h1
      class="p-4 text-3xl font-bold bg-gradient-to-l from-indigo-300 to bg-purple-400 bg-clip-text text-transparent"
    >
      Logged as {{ user().name }}
    </h1>
    <div class="mx-10 flex items-center gap-2 text-gray-300 font-bold">
      Users connected: {{ numUsersConnected() }}
    </div>
  </header>
  <section class="bg-slate-200 flex-1 overflow-y-auto p-4 space-y-3">
    @if (messages().length < 1) {
      <div class="flex justify-center items-center h-full">
        <p class="text-slate-500 text-sm">No messages yet</p>
      </div>
    } @else {
      @for (message of messages(); track message.id) {
        @if (!message.ownerId || message.ownerId == 'system') {
          <div class="flex justify-center">
            <span class="text-slate-500 text-xs bg-slate-300 px-3 py-1 rounded-full">
              {{ message.message }}
            </span>
          </div>
        } @else if (message.ownerId === user().name) {
          <div class="flex justify-end">
            <div class="max-w-[70%]">
              <div class="text-xs text-slate-600 mb-1 text-right">You</div>
              <div class="bg-indigo-600 text-white rounded-2xl rounded-tr-sm px-4 py-2">
                <p class="wrap-break-word">{{ message.message }}</p>
                <span class="text-xs text-indigo-200 mt-1 block text-right">
                  {{ message.timestamp | date: 'short' }}
                </span>
              </div>
            </div>
          </div>
        } @else {
          <div class="flex justify-start">
            <div class="max-w-[70%]">
              <div class="text-xs text-slate-600 mb-1">{{ message.ownerId }}</div>
              <div class="bg-white border border-slate-300 rounded-2xl rounded-tl-sm px-4 py-2">
                <p class="wrap-break-word text-slate-900">{{ message.message }}</p>
                <span class="text-xs text-slate-500 mt-1 block">
                  {{ message.timestamp | date: 'short' }}
                </span>
              </div>
            </div>
          </div>
        }
      }
    }
  </section>
  <footer class="h-24 p-2 bg-slate-200">
    <div
      class="bg-slate-200 borde rounded-xl mx-auto w-2/3 flex justify-center items-center h-full shadow-sm"
    >
      <form (submit)="sendMessage($event)" class="flex gap-2 w-full px-4">
        <input
          type="text"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          [formField]="messageForm.message"
          class="flex-1 px-4 py-2 bg-white border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
        />
        <button
          class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors"
          type="submit"
        >
          Send
        </button>
      </form>
    </div>
  </footer>
</main>
